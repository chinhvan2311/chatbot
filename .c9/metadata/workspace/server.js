{"filter":false,"title":"server.js","tooltip":"/server.js","undoManager":{"mark":30,"position":30,"stack":[[{"start":{"row":24,"column":41},"end":{"row":24,"column":66},"action":"remove","lines":["anh_hoang_dep_trai_vo_doi"],"id":2}],[{"start":{"row":24,"column":41},"end":{"row":24,"column":42},"action":"insert","lines":["f"],"id":3}],[{"start":{"row":24,"column":42},"end":{"row":24,"column":43},"action":"insert","lines":["a"],"id":4}],[{"start":{"row":24,"column":43},"end":{"row":24,"column":44},"action":"insert","lines":["c"],"id":5}],[{"start":{"row":24,"column":44},"end":{"row":24,"column":45},"action":"insert","lines":["e"],"id":6}],[{"start":{"row":24,"column":45},"end":{"row":24,"column":46},"action":"insert","lines":["b"],"id":7}],[{"start":{"row":24,"column":46},"end":{"row":24,"column":47},"action":"insert","lines":["o"],"id":8}],[{"start":{"row":24,"column":47},"end":{"row":24,"column":48},"action":"insert","lines":["o"],"id":9}],[{"start":{"row":24,"column":48},"end":{"row":24,"column":49},"action":"insert","lines":["k"],"id":10}],[{"start":{"row":24,"column":49},"end":{"row":24,"column":50},"action":"insert","lines":["_"],"id":11}],[{"start":{"row":24,"column":50},"end":{"row":24,"column":51},"action":"insert","lines":["c"],"id":12}],[{"start":{"row":24,"column":51},"end":{"row":24,"column":52},"action":"insert","lines":["h"],"id":13}],[{"start":{"row":24,"column":52},"end":{"row":24,"column":53},"action":"insert","lines":["a"],"id":14}],[{"start":{"row":24,"column":53},"end":{"row":24,"column":54},"action":"insert","lines":["t"],"id":15}],[{"start":{"row":24,"column":54},"end":{"row":24,"column":55},"action":"insert","lines":["_"],"id":16}],[{"start":{"row":24,"column":55},"end":{"row":24,"column":56},"action":"insert","lines":["b"],"id":17}],[{"start":{"row":24,"column":56},"end":{"row":24,"column":57},"action":"insert","lines":["o"],"id":18}],[{"start":{"row":24,"column":57},"end":{"row":24,"column":58},"action":"insert","lines":["o"],"id":19}],[{"start":{"row":24,"column":58},"end":{"row":24,"column":59},"action":"insert","lines":["t"],"id":20}],[{"start":{"row":24,"column":58},"end":{"row":24,"column":59},"action":"remove","lines":["t"],"id":21}],[{"start":{"row":24,"column":57},"end":{"row":24,"column":58},"action":"remove","lines":["o"],"id":22}],[{"start":{"row":24,"column":57},"end":{"row":24,"column":58},"action":"insert","lines":["t"],"id":23}],[{"start":{"row":24,"column":58},"end":{"row":24,"column":59},"action":"insert","lines":["_"],"id":24}],[{"start":{"row":24,"column":59},"end":{"row":24,"column":60},"action":"insert","lines":["c"],"id":25}],[{"start":{"row":24,"column":60},"end":{"row":24,"column":61},"action":"insert","lines":["h"],"id":26}],[{"start":{"row":24,"column":61},"end":{"row":24,"column":62},"action":"insert","lines":["i"],"id":27}],[{"start":{"row":24,"column":62},"end":{"row":24,"column":63},"action":"insert","lines":["n"],"id":28}],[{"start":{"row":24,"column":63},"end":{"row":24,"column":64},"action":"insert","lines":["h"],"id":29}],[{"start":{"row":0,"column":0},"end":{"row":36,"column":0},"action":"remove","lines":["// # SimpleServer","// A simple chat bot server","","var logger = require('morgan');","var http = require('http');","var bodyParser = require('body-parser');","var express = require('express');","var request = require('request');","var router = express();","","var app = express();","app.use(logger('dev'));","app.use(bodyParser.json());","app.use(bodyParser.urlencoded({","  extended: false","}));","var server = http.createServer(app);","","","app.get('/', (req, res) => {","  res.send(\"Home page. Server running okay.\");","});","","app.get('/webhook', function(req, res) {","  if (req.query['hub.verify_token'] === 'facebook_chat_bot_chinh') {","    res.send(req.query['hub.challenge']);","  }","  res.send('Error, wrong validation token');","});","","app.set('port', process.env.OPENSHIFT_NODEJS_PORT || process.env.PORT || 3002);","app.set('ip', process.env.OPENSHIFT_NODEJS_IP || process.env.IP || \"127.0.0.1\");","","server.listen(app.get('port'), app.get('ip'), function() {","  console.log(\"Chat bot server listening at %s:%d \", app.get('ip'), app.get('port'));","});",""],"id":30}],[{"start":{"row":0,"column":0},"end":{"row":75,"column":3},"action":"insert","lines":["// # SimpleServer","// A simple chat bot server","var logger = require('morgan');","var http = require('http');","var bodyParser = require('body-parser');","var express = require('express');","var router = express();","","var app = express();","app.use(logger('dev'));","app.use(bodyParser.json());","app.use(bodyParser.urlencoded({","  extended: false","}));","var server = http.createServer(app);","var request = require(\"request\");","","app.get('/', (req, res) => {","  res.send(\"Home page. Server running okay.\");","});","","// Đây là đoạn code để tạo Webhook","app.get('/webhook', function(req, res) {","  if (req.query['hub.verify_token'] === 'facebook_chat_bot_chinh') {","    res.send(req.query['hub.challenge']);","  }","  res.send('Error, wrong validation token');","});","","// Xử lý khi có người nhắn tin cho bot","app.post('/webhook', function(req, res) {","  var entries = req.body.entry;","  for (var entry of entries) {","    var messaging = entry.messaging;","    for (var message of messaging) {","      var senderId = message.sender.id;","      if (message.message) {","        // If user send text","        if (message.message.text) {","          var text = message.message.text;","          console.log(text); // In tin nhắn người dùng","          sendMessage(senderId, \"Tui là bot đây: \" + text);","        }","      }","    }","  }","","  res.status(200).send(\"OK\");","});","","","// Gửi thông tin tới REST API để trả lời","function sendMessage(senderId, message) {","  request({","    url: 'https://graph.facebook.com/v2.6/me/messages',","    qs: {","      access_token: \"token\",","    },","    method: 'POST',","    json: {","      recipient: {","        id: senderId","      },","      message: {","        text: message","      },","    }","  });","}","","app.set('port', process.env.OPENSHIFT_NODEJS_PORT || process.env.PORT || 3002);","app.set('ip', process.env.OPENSHIFT_NODEJS_IP || process.env.IP || \"127.0.0.1\");","","server.listen(app.get('port'), app.get('ip'), function() {","  console.log(\"Chat bot server listening at %s:%d \", app.get('ip'), app.get('port'));","});"],"id":31}],[{"start":{"row":56,"column":21},"end":{"row":56,"column":26},"action":"remove","lines":["token"],"id":32},{"start":{"row":56,"column":21},"end":{"row":56,"column":210},"action":"insert","lines":["EAALDIbZBWoBEBAEr4OMjl9kdZCoB9dnX5DWiD8JXcv69dtzIIs0I8oNXKusb3wSZAA4HFmJrUrMWJXHZCDZAc05GKR4S74CulshtuaJebZBZCd56cB2RBeJvsA1W0ZAI2cyS8SUHvIqigB9CSSbW61ZCCOcldUarA6Tvaezf1pVcZBqgZA9wZAfribCp"]}]]},"ace":{"folds":[],"scrolltop":817,"scrollleft":0,"selection":{"start":{"row":56,"column":6},"end":{"row":56,"column":6},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":57,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1509175936465,"hash":"0415ae29189da4b2493849e8bfd400662ac0cd36"}